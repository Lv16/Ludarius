{% extends "base.html" %}
{% load static %}

{% block title %}Início | Ludarius{% endblock %}

{% block content %}

<p>Encontre onde assistir e quanto custa.</p>

<form method="get" action="">
  <input
    type="text"
    name="q"
    placeholder="Buscar mídia (filmes, séries, animes)..."
    value="{{ q|default:'' }}"
    autocomplete="off"
  />
  <button type="submit">Buscar</button>

  {% if q %}
    <a href="/">Limpar</a>
  {% endif %}
</form>

{% if not q %}
{% if not q %}
  <p>
    <a href="/"{% if media_type == "all" %} style="text-decoration: underline;"{% endif %}>Em alta (Tudo)</a>
    |
    <a href="/?type=movie"{% if media_type == "movie" %} style="text-decoration: underline;"{% endif %}>Em alta (Filmes)</a>
    |
    <a href="/?type=tv"{% if media_type == "tv" %} style="text-decoration: underline;"{% endif %}>Em alta (Séries/Animes)</a>
  </p>
{% endif %}

  <hr>

  <div id="last-seen-section" style="display:none;">
    <h2>Continuar vendo</h2>
    <ul id="last-seen-list"></ul>

    <p> 
      <a href="#" id="last-seen-clear">Limpar histórico</a>
    </p>
    <ul id="last-seen-list"></ul>
    <hr>
  </div>


    <hr>

  <h2>Em alta hoje</h2>

  <ul>
    {% for r in trending_feed %}
      <li>
        {% if r.poster_url %}
          <img src="{{ r.poster_url }}" alt="Poster" width="50" style="vertical-align: middle;">
        {% endif %}

        {% if r.media_type == "movie" %}
          <a href="{% url 'tmdb_movie_detail' r.tmdb_id %}">
            <strong>{{ r.title }}</strong>
          </a>
          <span> — Filme</span>
        {% elif r.media_type == "tv" %}
          <a href="{% url 'tmdb_tv_detail' r.tmdb_id %}">
            <strong>{{ r.title }}</strong>
          </a>
          <span> — Série/Anime</span>
        {% endif %}

        {% if r.date %} ({{ r.date }}){% endif %}
        {% if r.rating %} — Nota: {{ r.rating }}{% endif %}
      </li>
    {% empty %}
      <li>Não foi possível carregar o feed em alta agora.</li>
    {% endfor %}
  </ul>

  <hr>
  <p>Dica: use a busca para encontrar filmes, séries e animes.</p>
{% endif %}

{% if q %}
  <hr>
  <h2>Resultados</h2>

  <ul>
    {% for r in results %}
      <li>
        {% if r.poster_url %}
          <img src="{{ r.poster_url }}" alt="Poster" width="50" style="vertical-align: middle;">
        {% endif %}

        {% if r.media_type == "movie" %}
          <a href="{% url 'tmdb_movie_detail' r.tmdb_id %}">
            <strong>{{ r.title }}</strong>
          </a>
          <span> — Filme</span>
        {% elif r.media_type == "tv" %}
          <a href="{% url 'tmdb_tv_detail' r.tmdb_id %}">
            <strong>{{ r.title }}</strong>
          </a>
          <span> — Série/Anime</span>
        {% endif %}

        {% if r.date %} ({{ r.date }}){% endif %}
        {% if r.rating %} — Nota: {{ r.rating }}{% endif %}
      </li>
    {% empty %}
      <li>Nenhum resultado encontrado para “{{ q }}”.</li>
    {% endfor %}
  </ul>
{% endif %}

<script src="{% static 'js/home.js' %}"></script>

{% endblock %}

